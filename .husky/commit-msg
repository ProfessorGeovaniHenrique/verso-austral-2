#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Validar formato de mensagem de commit (Conventional Commits)
commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Regex para Conventional Commits
commit_regex='^(feat|fix|docs|style|refactor|test|chore|perf|ci|build|revert)(\(.+\))?: .{1,}'

if ! echo "$commit_msg" | grep -qE "$commit_regex"; then
  echo ""
  echo "‚ùå Mensagem de commit inv√°lida!"
  echo ""
  echo "üìù Use o formato Conventional Commits:"
  echo ""
  echo "   <tipo>(<escopo>): <descri√ß√£o>"
  echo ""
  echo "Tipos v√°lidos:"
  echo "   feat:     Nova funcionalidade"
  echo "   fix:      Corre√ß√£o de bug"
  echo "   docs:     Documenta√ß√£o"
  echo "   style:    Formata√ß√£o (n√£o afeta l√≥gica)"
  echo "   refactor: Refatora√ß√£o de c√≥digo"
  echo "   test:     Adicionar/corrigir testes"
  echo "   chore:    Manuten√ß√£o/config"
  echo "   perf:     Melhoria de performance"
  echo "   ci:       Configura√ß√£o CI/CD"
  echo "   build:    Sistema de build"
  echo "   revert:   Reverter commit anterior"
  echo ""
  echo "Exemplos v√°lidos:"
  echo "   feat: adicionar an√°lise de pros√≥dia"
  echo "   fix(corpus): corrigir lema de 'saudade'"
  echo "   docs: atualizar README com instru√ß√µes"
  echo "   refactor: simplificar componente TabStatistics"
  echo ""
  echo "Sua mensagem: '$commit_msg'"
  echo ""
  echo "‚ö†Ô∏è  Para bypass: git commit --no-verify"
  echo ""
  exit 1
fi
